<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aurora 3.0 â€” Qwen Edition</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’¬</text></svg>" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Outfit', 'sans-serif'] },
          colors: {
            rose: { 50: '#fff1f2', 100: '#ffe4e6', 200: '#fecdd3', 300: '#fda4af', 400: '#fb7185', 500: '#f43f5e', 600: '#e11d48', 700: '#be123c', 800: '#9f1239', 900: '#881337' },
            slate: { 850: '#172033', 950: '#0c1222' }
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Outfit', sans-serif;
    }

    .gradient-bg {
      background: linear-gradient(-45deg, #000000, #1a0b1e, #0c1222, #2d0b2e);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
    }

    @keyframes gradient {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #334155;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #475569;
    }
  </style>
</head>

<body class="gradient-bg min-h-screen text-slate-100 antialiased">
  <div class="max-w-4xl mx-auto px-4 py-8">
    <header class="text-center mb-10">
      <div
        class="inline-block px-3 py-1 rounded-full bg-yellow-500/10 border border-yellow-500/30 text-yellow-500 text-[10px] font-bold tracking-widest uppercase mb-4">
        Version 3.0 Gold</div>
      <h1
        class="text-4xl font-black bg-gradient-to-r from-yellow-400 via-white to-yellow-600 bg-clip-text text-transparent italic">
        AURORA QWEN</h1>
      <p class="text-slate-500 mt-2 font-light tracking-wide">Elite Operations Center (Instagram & Telegram)</p>
    </header>

    <!-- Estado del Sistema -->
    <section class="rounded-2xl bg-slate-800/60 border border-slate-700/50 p-4 mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="w-3 h-3 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.6)]"></span>
          <span class="font-medium">ğŸŒ Sistema Activo â€” Render 24/7</span>
        </div>
        <div class="flex items-center gap-3">
          <span class="text-slate-300 text-sm font-medium">Modo AutomÃ¡tico (IA)</span>
          <button id="autoModeToggle" type="button" role="switch" aria-checked="false"
            class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent bg-slate-600 transition-colors focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 focus:ring-offset-slate-800">
            <span id="autoModeThumb"
              class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition translate-x-0.5"></span>
          </button>
        </div>
      </div>
    </section>



    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- ASISTENTE DE RESPUESTAS (Copia & Pega IA)  -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="rounded-2xl bg-slate-800/60 border border-violet-700/30 p-6 mb-6"
      style="box-shadow:0 0 30px rgba(139,92,246,0.08)">
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-xl font-semibold text-slate-200">ğŸ’¬ Asistente de Respuestas</h2>
        <span
          class="px-2 py-0.5 rounded text-[10px] bg-violet-600/30 text-violet-400 border border-violet-600/50 font-medium tracking-wider">IA
          Â· COPIA &amp; PEGA</span>
      </div>

      <!-- Selectores de plataforma, idioma y tono -->
      <div class="grid grid-cols-3 gap-3 mb-4">
        <div class="bg-slate-900/80 border border-slate-700/50 rounded-xl px-3 py-2.5">
          <span class="text-violet-400 text-[9px] font-bold uppercase tracking-widest block mb-1">ğŸ“± Plataforma</span>
          <select id="replyPlatform"
            class="w-full bg-transparent text-slate-200 text-sm font-medium focus:outline-none cursor-pointer">
            <option value="instagram">ğŸ“¸ Instagram</option>
            <option value="whatsapp">ğŸ’¬ WhatsApp</option>
            <option value="telegram">âœˆï¸ Telegram</option>
            <option value="fanvue">ğŸ’œ Fanvue</option>
          </select>
        </div>
        <div class="bg-slate-900/80 border border-slate-700/50 rounded-xl px-3 py-2.5">
          <span class="text-violet-400 text-[9px] font-bold uppercase tracking-widest block mb-1">ğŸŒ Idioma</span>
          <select id="replyLanguage"
            class="w-full bg-transparent text-slate-200 text-sm font-medium focus:outline-none cursor-pointer">
            <option value="es-co">ğŸ‡¨ğŸ‡´ EspaÃ±ol</option>
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          </select>
        </div>
        <div class="bg-slate-900/80 border border-slate-700/50 rounded-xl px-3 py-2.5">
          <span class="text-violet-400 text-[9px] font-bold uppercase tracking-widest block mb-1">ğŸ­ Tono</span>
          <select id="replyTone"
            class="w-full bg-transparent text-slate-200 text-sm font-medium focus:outline-none cursor-pointer">
            <option value="coqueta">ğŸ˜˜ Coqueta</option>
            <option value="dulce">ğŸ¥° Dulce</option>
            <option value="vendedora">ğŸ’° Vendedora</option>
            <option value="dominante">ğŸ˜ˆ Dominante (los trata mal)</option>
          </select>
        </div>
      </div>

      <!-- Mensaje del cliente -->
      <div class="mb-3">
        <label class="text-slate-400 text-xs font-medium block mb-1.5">ğŸ“¥ Pega aquÃ­ el mensaje del cliente:</label>
        <textarea id="replyInput" rows="3" placeholder="Ej: hola bb cÃ³mo estÃ¡s? ğŸ˜Š"
          class="w-full rounded-xl bg-slate-900/80 border border-slate-600 text-slate-100 placeholder-slate-500 px-4 py-3 resize-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 outline-none transition"></textarea>
      </div>

      <!-- BotÃ³n generar -->
      <button id="generateReply"
        class="w-full px-6 py-4 rounded-xl bg-violet-600 hover:bg-violet-500 text-white font-bold transition-all transform hover:scale-[1.01] shadow-[0_0_20px_rgba(139,92,246,0.35)] flex items-center justify-center gap-2 mb-4">
        <span>ğŸ¤–</span> GENERAR RESPUESTA CON IA
      </button>

      <!-- Respuesta generada -->
      <div id="replyOutputContainer" class="hidden">
        <label class="text-slate-400 text-xs font-medium block mb-1.5">ğŸ“¤ Respuesta de Aurora â€” lista para
          pegar:</label>
        <div class="relative">
          <textarea id="replyOutput" rows="3" readonly
            class="w-full rounded-xl bg-black/50 border border-violet-500/40 text-slate-100 px-4 py-3 pr-28 resize-none outline-none font-medium text-sm leading-relaxed"></textarea>
          <button id="copyReply"
            class="absolute bottom-3 right-3 px-4 py-1.5 rounded-lg bg-violet-600 hover:bg-violet-500 text-white text-xs font-bold transition-all active:scale-95">
            ğŸ“‹ Copiar
          </button>
        </div>
        <p id="copiedMsg" class="text-emerald-400 text-xs mt-1 hidden text-right font-semibold">âœ… Â¡Copiado al
          portapapeles!</p>
      </div>

      <p id="replyError" class="text-rose-400 text-sm hidden mt-2"></p>
    </section>



    <!-- Links RÃ¡pidos -->
    <section class="rounded-2xl bg-slate-800/60 border border-slate-700/50 p-5">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-slate-200">ğŸ”— Links RÃ¡pidos</h2>
        <span
          class="px-2 py-0.5 rounded text-[10px] bg-emerald-600/20 text-emerald-400 border border-emerald-600/30 font-medium tracking-wider">COPIA
          & PEGA</span>
      </div>
      <div class="space-y-2" id="linksPanel">

        <!-- Fanvue -->
        <div class="flex items-center gap-3 bg-slate-900/60 rounded-xl px-4 py-2.5 border border-slate-700/40">
          <span class="text-lg">ğŸ’œ</span>
          <div class="flex-1 min-w-0">
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Fanvue</p>
            <a href="https://www.fanvue.com/utopiafinca" target="_blank"
              class="text-sm text-violet-400 hover:text-violet-300 truncate block">fanvue.com/utopiafinca</a>
          </div>
          <button onclick="copyLink(this,'https://www.fanvue.com/utopiafinca')"
            class="px-3 py-1 rounded-lg bg-violet-600/80 hover:bg-violet-500 text-white text-xs font-bold transition active:scale-95 shrink-0">ğŸ“‹
            Copiar</button>
        </div>

        <!-- PÃ¡gina de Ventas -->
        <div class="flex items-center gap-3 bg-slate-900/60 rounded-xl px-4 py-2.5 border border-slate-700/40">
          <span class="text-lg">ğŸ›’</span>
          <div class="flex-1 min-w-0">
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">PÃ¡gina de Ventas (Ebook)</p>
            <a href="https://web-dominio-total.vercel.app" target="_blank"
              class="text-sm text-rose-400 hover:text-rose-300 truncate block">web-dominio-total.vercel.app</a>
          </div>
          <button onclick="copyLink(this,'https://web-dominio-total.vercel.app')"
            class="px-3 py-1 rounded-lg bg-rose-600/80 hover:bg-rose-500 text-white text-xs font-bold transition active:scale-95 shrink-0">ğŸ“‹
            Copiar</button>
        </div>

        <!-- Telegram Comunidad -->
        <div class="flex items-center gap-3 bg-slate-900/60 rounded-xl px-4 py-2.5 border border-slate-700/40">
          <span class="text-lg">âœˆï¸</span>
          <div class="flex-1 min-w-0">
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Telegram Comunidad VIP</p>
            <a href="https://t.me/+QuX6mkbTG7A3Y2Fh" target="_blank"
              class="text-sm text-sky-400 hover:text-sky-300 truncate block">t.me/+QuX6mkbTG7A3Y2Fh</a>
          </div>
          <button onclick="copyLink(this,'https://t.me/+QuX6mkbTG7A3Y2Fh')"
            class="px-3 py-1 rounded-lg bg-sky-600/80 hover:bg-sky-500 text-white text-xs font-bold transition active:scale-95 shrink-0">ğŸ“‹
            Copiar</button>
        </div>

        <!-- Telegram Bot -->
        <div class="flex items-center gap-3 bg-slate-900/60 rounded-xl px-4 py-2.5 border border-slate-700/40">
          <span class="text-lg">ğŸ¤–</span>
          <div class="flex-1 min-w-0">
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Bot de Telegram (Aurora)</p>
            <a href="https://t.me/utopiafincabot" target="_blank"
              class="text-sm text-sky-400 hover:text-sky-300 truncate block">t.me/utopiafincabot</a>
          </div>
          <button onclick="copyLink(this,'https://t.me/utopiafincabot')"
            class="px-3 py-1 rounded-lg bg-sky-600/80 hover:bg-sky-500 text-white text-xs font-bold transition active:scale-95 shrink-0">ğŸ“‹
            Copiar</button>
        </div>

        <!-- Instagram -->
        <div class="flex items-center gap-3 bg-slate-900/60 rounded-xl px-4 py-2.5 border border-slate-700/40">
          <span class="text-lg">ğŸ“¸</span>
          <div class="flex-1 min-w-0">
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Instagram</p>
            <a href="https://www.instagram.com/luzdeaurorafeyamor/" target="_blank"
              class="text-sm text-pink-400 hover:text-pink-300 truncate block">instagram.com/luzdeaurorafeyamor</a>
          </div>
          <button onclick="copyLink(this,'https://www.instagram.com/luzdeaurorafeyamor/')"
            class="px-3 py-1 rounded-lg bg-pink-600/80 hover:bg-pink-500 text-white text-xs font-bold transition active:scale-95 shrink-0">ğŸ“‹
            Copiar</button>
        </div>

        <!-- WhatsApp -->
        <div class="flex items-center gap-3 bg-slate-900/60 rounded-xl px-4 py-2.5 border border-slate-700/40">
          <span class="text-lg">ğŸ’¬</span>
          <div class="flex-1 min-w-0">
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">WhatsApp</p>
            <a href="https://wa.me/573227198007" target="_blank"
              class="text-sm text-emerald-400 hover:text-emerald-300 truncate block">+57 322 719 8007</a>
          </div>
          <button onclick="copyLink(this,'https://wa.me/573227198007')"
            class="px-3 py-1 rounded-lg bg-emerald-600/80 hover:bg-emerald-500 text-white text-xs font-bold transition active:scale-95 shrink-0">ğŸ“‹
            Copiar</button>
        </div>

      </div>
    </section>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const autoModeToggle = document.getElementById('autoModeToggle');
    const autoModeThumb = document.getElementById('autoModeThumb');
    const embudoList = document.getElementById('embudoList');
    const fanvueLink = document.getElementById('fanvueLink');
    const copyFanvue = document.getElementById('copyFanvue');
    const ttsText = document.getElementById('ttsText');
    const voiceSelect = document.getElementById('voiceSelect');
    const styleSelect = document.getElementById('styleSelect');
    const styleContainer = document.getElementById('styleContainer');
    const generateAudio = document.getElementById('generateAudio');
    const sendAudio = document.getElementById('sendAudio');
    const audioPlayer = document.getElementById('audioPlayer');
    const ttsError = document.getElementById('ttsError');
    const logMonitor = document.getElementById('logMonitor');

    let lastGeneratedAudioPath = null;
    let autoMode = false;

    // --- VISOR DE LOGS ---
    function appendLog(text) {
      if (!text) return;
      const p = document.createElement('p');
      p.className = 'border-l border-emerald-500/30 pl-2 mb-1';
      p.textContent = text;
      logMonitor.appendChild(p);
      logMonitor.scrollTop = logMonitor.scrollHeight;
      if (logMonitor.children.length > 50) logMonitor.removeChild(logMonitor.firstChild);
    }

    setInterval(async () => {
      try {
        const r = await fetch('/api/instagram-logs');
        const data = await r.json();
        if (data.logs) {
          logMonitor.innerHTML = '';
          data.logs.split('\n').filter(l => l.trim()).forEach(appendLog);
        }
      } catch (e) { }
    }, 4000);

    // --- MODO AUTOMÃTICO ---
    function setAutoModeUI(on) {
      autoMode = on;
      autoModeToggle.setAttribute('aria-checked', on);
      if (on) {
        autoModeToggle.classList.replace('bg-slate-600', 'bg-rose-500');
        autoModeThumb.classList.replace('translate-x-0.5', 'translate-x-5');
      } else {
        autoModeToggle.classList.replace('bg-rose-500', 'bg-slate-600');
        autoModeThumb.classList.replace('translate-x-5', 'translate-x-0.5');
      }
    }

    autoModeToggle.addEventListener('click', async () => {
      const next = !autoMode;
      setAutoModeUI(next);
      try {
        await fetch('/api/auto-mode', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ autoMode: next })
        });
      } catch (e) { }
    });

    socket.on('autoMode', (value) => setAutoModeUI(!!value));

    // --- EMBUDO ---
    socket.on('embudo', (list) => {
      embudoList.innerHTML = '';
      if (!list || list.length === 0) {
        embudoList.innerHTML = '<p class="text-slate-500 text-sm text-center py-10">Esperando actividad de Instagram...</p>';
        return;
      }
      const labels = ['Enamoramiento', 'Calentamiento', 'Venta / Fanvue'];
      const colors = ['bg-blue-500', 'bg-amber-500', 'bg-rose-500'];

      list.sort((a, b) => b.hours_ago - a.hours_ago).forEach((c) => {
        const phase = Math.min(3, Math.max(1, c.phase || 1));
        const name = c.username || c.chatName || 'Usuario';
        const div = document.createElement('div');
        div.className = 'bg-slate-800/40 p-3 rounded-xl border border-slate-700/30';
        div.innerHTML = `
          <div class="flex justify-between items-start mb-1">
            <span class="font-medium text-slate-200 truncate">${name}</span>
            <span class="text-[10px] text-slate-500">${c.hours_ago}h ago</span>
          </div>
          <p class="text-xs text-slate-400 truncate mb-2">"${c.body || '...'}"</p>
          <div class="flex gap-1">
            ${[1, 2, 3].map(p => `<span class="h-1.5 flex-1 rounded-full ${p <= phase ? colors[p - 1] : 'bg-slate-700'}"></span>`).join('')}
          </div>
        `;
        embudoList.appendChild(div);
      });
    });

    // --- TTS Y AUDIO ---
    generateAudio.addEventListener('click', async () => {
      const text = ttsText.value.trim();
      if (!text) return;
      ttsError.classList.add('hidden');
      generateAudio.disabled = true;
      const originalHtml = generateAudio.innerHTML;
      generateAudio.innerHTML = '<span>â³</span> COCINANDO QWEN (Reintentando si falla)...';
      try {
        const r = await fetch('/api/generate-audio', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            text,
            voice: voiceSelect.value,
            style: voiceSelect.value === 'qwen' ? styleSelect.value : null
          })
        });
        const data = await r.json();
        if (data.ok && data.audioBase64) {
          lastGeneratedAudioPath = data.path;
          audioPlayer.src = 'data:audio/mpeg;base64,' + data.audioBase64;
          audioPlayer.classList.remove('hidden');
          audioPlayer.play();
          sendAudio.disabled = false;
        } else {
          ttsError.textContent = data.error || 'Error al generar';
          ttsError.classList.remove('hidden');
        }
      } catch (e) {
        ttsError.textContent = 'Error de red';
        ttsError.classList.remove('hidden');
      }
      generateAudio.disabled = false;
      generateAudio.innerHTML = originalHtml;
    });

    sendAudio.addEventListener('click', async () => {
      if (!lastGeneratedAudioPath) return;
      sendAudio.disabled = true;
      try {
        const r = await fetch('/api/send-audio', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ audioPath: lastGeneratedAudioPath, target: 'telegram' })
        });
        const data = await r.json();
        if (data.ok) alert('âœ… Audio enviado a Telegram');
        else alert('âŒ Error: ' + data.error);
      } catch (e) { alert('Error de red'); }
      sendAudio.disabled = false;
    });

    // --- CONFIG INICIAL ---
    (async () => {
      try {
        const [rAuto] = await Promise.all([fetch('/api/auto-mode')]);
        const dAuto = await rAuto.json();
        setAutoModeUI(!!dAuto.autoMode);
      } catch (e) { }
    })();

    // --- COPIAR LINKS RÃPIDOS ---
    function copyLink(btn, url) {
      navigator.clipboard.writeText(url).then(() => {
        const original = btn.textContent;
        btn.textContent = 'âœ… Copiado';
        btn.classList.add('bg-emerald-600');
        setTimeout(() => {
          btn.textContent = original;
          btn.classList.remove('bg-emerald-600');
        }, 2000);
      });
    }

    function escapeHtml(s) {
      const el = document.createElement('div');
      el.textContent = s;
      return el.innerHTML;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ASISTENTE DE RESPUESTAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const generateReply = document.getElementById('generateReply');
    const replyInput = document.getElementById('replyInput');
    const replyPlatform = document.getElementById('replyPlatform');
    const replyLanguage = document.getElementById('replyLanguage');
    const replyTone = document.getElementById('replyTone');
    const replyOutputContainer = document.getElementById('replyOutputContainer');
    const replyOutput = document.getElementById('replyOutput');
    const copyReply = document.getElementById('copyReply');
    const copiedMsg = document.getElementById('copiedMsg');
    const replyError = document.getElementById('replyError');

    generateReply.addEventListener('click', async () => {
      const message = replyInput.value.trim();
      if (!message) {
        replyError.textContent = 'âš ï¸ Pega primero el mensaje del cliente';
        replyError.classList.remove('hidden');
        return;
      }
      replyError.classList.add('hidden');
      replyOutputContainer.classList.add('hidden');
      generateReply.disabled = true;
      generateReply.innerHTML = '<span>â³</span> Generando respuesta...';
      try {
        const r = await fetch('/api/generate-reply', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message,
            platform: replyPlatform.value,
            language: replyLanguage.value,
            tone: replyTone.value
          })
        });
        const data = await r.json();
        if (data.ok && data.reply) {
          replyOutput.value = data.reply;
          replyOutputContainer.classList.remove('hidden');
          replyOutput.focus();
        } else {
          replyError.textContent = data.error || 'Error generando respuesta';
          replyError.classList.remove('hidden');
        }
      } catch (e) {
        replyError.textContent = 'Error de red: ' + e.message;
        replyError.classList.remove('hidden');
      }
      generateReply.disabled = false;
      generateReply.innerHTML = '<span>ğŸ¤–</span> GENERAR RESPUESTA CON IA';
    });

    copyReply.addEventListener('click', () => {
      if (!replyOutput.value) return;
      navigator.clipboard.writeText(replyOutput.value).then(() => {
        copiedMsg.classList.remove('hidden');
        copyReply.textContent = 'âœ… Copiado';
        setTimeout(() => {
          copiedMsg.classList.add('hidden');
          copyReply.textContent = 'ğŸ“‹ Copiar';
        }, 2500);
      });
    });
  </script>
</body>

</html>